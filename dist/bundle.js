!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t){e.exports=require("config")},function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(5)),s=o(n(3)),u=n(6).verbose(),i=o(n(0)),c=r.default.join(process.cwd(),i.default.get("db.path"));let a;s.default.existsSync(c)?a=u.cached.Database(c):(s.default.mkdirSync(r.default.dirname(c),{recursive:!0}),a=new u.Database(c,e=>{if(e)throw new Error("Failed to create a database connection");console.log("Connected to the words count database."),a.run("CREATE TABLE IF NOT EXISTS words_statistics (\n            word VARCHAR(50) PRIMARY KEY,\n            counter INTEGER DEFAULT 0 NOT NULL\n        ) WITHOUT ROWID;")})),t.default=a},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(0)),s=o(n(1)),u=o(n(7)),i=parseInt(process.env.PORT,10)||r.default.get("server.port"),c=u.default.listen(i,e=>e?console.error(e):console.log(`server is listening on ${i}`));process.on("SIGTERM",()=>{console.info("Shutting down the server..."),c.close(()=>{s.default.close(e=>{e&&console.error(e.message),console.log("SQLite connection closed."),process.exit(0)})})})},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("sqlite3")},function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(2)),s=o(n(8)),u=o(n(9)),i=o(n(10)),c=o(n(16)),a=n(20),d=r.default();d.use(u.default()),d.use(s.default()),d.use(r.default.json()),d.use("/word-counter",i.default),d.use("/word-statistics",c.default),d.use(a.errorHandler),t.default=d},function(e,t){e.exports=require("compression")},function(e,t){e.exports=require("helmet")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(2),r=n(11),s=o.Router();s.post("/",r.postWordCount),t.default=s},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function u(e){try{c(o.next(e))}catch(e){s(e)}}function i(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,i)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(12),s={filepath:r.countWordsInTextFile,url:r.countWordsInTextFromURL};t.postWordCount=(e,t,n)=>o(void 0,void 0,void 0,(function*(){var o;const u="false"!==(null===(o=e.query)||void 0===o?void 0:o.async);if(e.is("text/plain"))u?r.countWordsInTextBody(e):yield r.countWordsInTextBody(e),t.sendStatus(200);else if(e.is("application/json")){const o=e.body.filepath?"filepath":e.body.url&&"url";if(console.log("%%%%%%%%%%% ",o),!o)return void t.status(400).send("Could not find valid properties in the body. Was expecting either a 'filepath' or a 'url'");try{u?s[o](e.body[o]):yield s[o](e.body[o]),t.sendStatus(200)}catch(e){n(e)}}else t.status(400).send("An unsupported Content-Type was provided")}))},function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(3)),s=o(n(13)),u=o(n(0)),i=n(14),c=n(15);function a(e){const t=i.cleanUpText(e).split(";").reduce((e,t)=>(e[t]=(e[t]||0)+1,e),{});return c.insertWordStatistics(t)}function d(e,t){return new Promise((n,o)=>{const r=[];let s=0;e.on("data",e=>{r.push(a(e)),console.info("Processed data chunk number: ",++s)}),e.on("error",o),e.on("end",()=>{Promise.all(r).then(()=>{console.log(`[${(new Date).toISOString()}] Finished processing: `,t),n()}).catch(o)})})}t.countWordsInTextBody=e=>(e.setEncoding(u.default.get("fileParsing.encoding")),d(e,"request")),t.countWordsInTextFile=e=>d(r.default.createReadStream(e,{encoding:u.default.get("fileParsing.encoding"),highWaterMark:1024*(u.default.get("fileParsing.streamWaterMark")||64)}),e),t.countWordsInTextFromURL=e=>d(s.default.get(e,{encoding:u.default.get("fileParsing.encoding"),gzip:!0}),e),t.countWordsInText=a},function(e,t){e.exports=require("request")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cleanUpText=e=>e.trim().replace(/[&\/\\#,+()!$~%.'":^|@;\[\]*?=<>{}]/g,"").replace(/\s+/g,";").replace(/([0-9]+(?=[a-z])|(?<=[a-z])[0-9]+)/gi,"").toLowerCase()},function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(1));t.insertWordStatistics=e=>new Promise((t,n)=>{r.default.parallelize(()=>{const o=r.default.prepare("INSERT INTO words_statistics (word, counter) VALUES(:word, :counter)\nON CONFLICT(word)\nDO UPDATE SET counter = counter + :counter;");Object.entries(e).forEach(e=>{o.run(e,e=>{e&&n(e)})}),o.finalize(e=>{e?n(e):t()})})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(2),r=n(17),s=o.Router();s.get("/",r.getWordStatistics),t.default=s},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function u(e){try{c(o.next(e))}catch(e){s(e)}}function i(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,i)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(18);t.getWordStatistics=(e,t,n)=>o(void 0,void 0,void 0,(function*(){const{word:o}=e.query;if(o)try{const e=yield r.queryWordCount(o);t.status(200).send(e.toString())}catch(e){n(e)}else t.sendStatus(400)}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(19);t.queryWordCount=e=>o.selectWordCount(e)},function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(1));t.selectWordCount=e=>new Promise((t,n)=>{r.default.get("SELECT counter FROM words_statistics WHERE word = (?)",[e],(e,o)=>{var r;e?n(e):t(null!==(r=null==o?void 0:o.counter)&&void 0!==r?r:0)})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorHandler=(e,t,n,o)=>{n.status(500).json({message:e.message})}}]);